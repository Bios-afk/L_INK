<!-- app/views/users/show.html.erb -->
<div class="container my-4">
  <div class="card mb-4 shadow-sm">
    <div class="row g-0 align-items-center">

      <!-- Avatar -->
      <div class="col-12 col-md-4 text-center p-3">
        <%= image_tag @user.avatar.attached? ? url_for(@user.avatar) : asset_path("pic-profile-default.png"), class: "rounded-circle img-fluid", alt: "Avatar" %>
        <%= link_to 'Modifier avatar', edit_user_registration_path, class: "btn btn-sm btn-outline-secondary mt-2" %>
      </div>

      <!-- Infos -->
      <div class="col-12 col-md-8 p-3">
        <% case @user.userable %>
        <% when Client %>
          <p><%= @user.userable.description %></p>
          <% if user_signed_in? && current_user == @user %>
            <%= link_to 'Modifier description', edit_user_registration_path, class: "btn btn-sm btn-outline-secondary mt-3" %>
          <% end %>

        <% when Artist %>
          <!-- Ligne 1 : note -->
          <div class="mb-2">
            <%= render 'shared/rating_stars', rating: @user.userable.average_rating %>
            <small class="text-muted ms-2">(<%= @user.userable.reviews_count %> avis)</small>
          </div>

          <!-- Ligne 2 : description -->
          <p><%= @user.userable.description %></p>

          <!-- Ligne 3 : styles + localisation -->
          <div class="d-flex justify-content-between">
            <span><strong>Styles :</strong> <%= @user.userable.styles %></span>
            <span><strong>Localisation :</strong> <%= @user.userable.location %></span>
          </div>

          <% if user_signed_in? && current_user == @user %>
            <%= link_to 'Modifier mon profil', edit_user_registration_path, class: "btn btn-sm btn-outline-secondary mt-3" %>
          <% end %>
        <% end %>
      </div>
    </div>
  </div>

  <% if @user.userable_type == "Artist" %>
    <!-- Bouton Devis -->
    <div class="text-center mb-4">
      <%= button_to 'Demander un devis', new_quote_path(user_id: @user.id), class: "btn btn-primary" %>
    </div>

    <!-- Top 3 photos -->
    <div class="mb-4">
      <h6>Top 3</h6>
      <div class="d-flex gap-2">
        <% @user.userable.photos.where(top_three: true).limit(3).each do |photo| %>
          <%= image_tag photo.url, class: "img-thumbnail", style: "width: 100px;" %>
        <% end %>
      </div>
    </div>

    <!-- Galerie Ã©tendue -->
    <div>
      <h6>Galerie</h6>
      <div class="d-flex flex-wrap gap-2">
        <% @user.userable.photos.where(top_three: false).each do |photo| %>
          <%= image_tag photo.url, class: "img-thumbnail", style: "width: 100px;" %>
        <% end %>
      </div>
    </div>
  <% end %>

</div>
