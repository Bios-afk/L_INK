<div class="body-profile-container d-flex flex-column align-items-center justify-content-center">
  <% if artist.user != current_user %>
    <div class="body-profile-button mt-3 w-100 d-flex justify-content-center gap-2 pb-3">

    <!-- FOLLOW / UNFOLLOW -->
    <% if user_signed_in? %>
      <% follow = current_user.follows.find_by(artist_id: artist.id) %>
      <% followed = follow.present? %>

        <%= form_with url: (followed ? follow_path(follow) : follows_path),
              method: (followed ? :delete : :post),
              format: :turbo_stream,
              id: "follow_btn_#{artist.id}",
              class: "d-inline" do %>

        <%# -- Champ caché seulement quand on crée le follow -- %>
        <% unless followed %>
          <%= hidden_field_tag :artist_id, artist.id %>
        <% end %>

        <button type="submit" class="btn btn-primary text-light" title="<%= followed ? 'Ne plus suivre' : 'Suivre' %>">
          <% if followed %>
            <i class="fa-solid fa-heart"></i>
          <% else %>
            <i class="fa-regular fa-heart"></i>
          <% end %>
        </button>
      <% end %>

    <% else %>
      <%= link_to new_user_session_path, class: "btn btn-primary text-light" do %>
        <i class="fa-regular fa-heart"></i>
      <% end %>
    <% end %>


      <!-- Bouton Devis -->
      <% if user_signed_in? %>
        <% if current_user.userable_type == "Client" %>
          <% already_requested = QuoteRequest.exists?(client: current_user.userable, artist: artist) %>
          <% unless already_requested %>
            <%= link_to 'Demande de devis', new_artist_quote_request_path(artist), class: "btn btn-primary text-light" %>
          <% end %>
        <% end %>
      <% else %>
        <%= link_to 'Demande de devis', new_user_session_path, class: "btn btn-primary text-light" %>
      <% end %>

    </div>
  <% end %>

  <% if artist.photos.attached? %>

    <div class="row mt-4 w-100">
      <% artist.photos.each do |photo| %>
        <div class="col-4 p-1">
          <%= cl_image_tag photo.key, crop: :fill, aspect_ratio: "4:5", gravity: :auto, class: "publication rounded w-100" %>
        </div>
      <% end %>
    </div>

  <% else %>

    <div class="row mt-4 w-100">
      <% 12.times do %>
        <div class="col-4 p-1">
          <%= image_tag 'publi.png', class: "publication rounded w-100" %>
        </div>
      <% end %>
    </div>
  <% end %>
  <% if artist.user == current_user %>
    <label for="photos-upload" style="cursor: pointer;">
      <div class="button-add-photos rounded-circle d-flex justify-content-center align-items-center">
        <i class="fa-solid fa-plus" style="color:rgb(227, 227, 227);"></i>
      </div>
    </label>

    <%= form_with(model: current_user.userable, url: upload_photo_path, method: :patch, html: { multipart: true }) do |f| %>
      <%= f.file_field :photos, id: "photos-upload", multiple: true, class: "d-none", accept: "image/*", onchange: "this.form.submit()" %>
    <% end %>
  <% end %>
</div>
