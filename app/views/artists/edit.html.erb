<div class="devise-container" data-controller="category-filter-signup">
  <h2>Mettre √† jour votre profil artiste</h2>

  <!-- üîÅ On englobe tout le bloc cat√©gorie dans le contr√¥leur -->
  <div>

    <!-- üé® Bouton d‚Äôouverture -->
    <div
      class="mb-3 d-flex justify-content-between align-items-center"
      style="cursor: pointer;"
      data-bs-toggle="offcanvas"
      data-bs-target="#categoryOffcanvas"
      aria-controls="categoryOffcanvas"
    >
      <label class="form-label mb-0">Cat√©gories</label>
      <span class="fs-4">&rsaquo;</span>
    </div>

    <!-- ‚úÖ Zone des badges s√©lectionn√©s -->
    <div
      id="selected-categories"
      class="mb-3"
      data-category-filter-signup-target="container"
    ></div>

    <!-- üß© Offcanvas -->
    <div
      class="offcanvas offcanvas-bottom custom-height"
      tabindex="-1"
      id="categoryOffcanvas"
      aria-labelledby="categoryOffcanvasLabel"
    >
      <div class="offcanvas-header">
        <h5 class="offcanvas-title" id="categoryOffcanvasLabel">Quels styles tatouez-vous ?</h5>
        <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Fermer"></button>
      </div>

      <div class="offcanvas-body" style="overflow-y: auto; max-height: 80vh;">
        <% Category.all.each do |category| %>
          <div class="form-check mb-2">
            <input
              class="form-check-input"
              type="checkbox"
              value="<%= category.id %>"
              id="category_<%= category.id %>"
              data-category-filter-signup-target="checkbox"
            >
            <label class="form-check-label" for="category_<%= category.id %>">
              <%= category.name %>
            </label>
          </div>
        <% end %>

        <button
          type="button"
          class="btn btn-primary w-100"
          id="applyCategories"
          data-action="click->category-filter-signup#applyCategories"
        >
          Valider
        </button>

      </div>
    </div>

  </div> <!-- fin du bloc contr√¥leur -->


    <%= simple_form_for @user, url: user_path(@user), method: :patch, html: { data: {category_filter_signup_target: "form"}} do |f| %>

      <%= hidden_field_tag "user[category_ids][]", "", id: "selected_category_ids" %>

      <div class="row">
        <div class="col-md-12">
          <%= f.input :bio, label: "Quelques mots sur vous...", as: :text, input_html: { rows: 4, maxlength: 100 } %>
        </div>
      </div>

      <div class="row">
        <div class="col-md-12">
          <%= f.input :userable_address,
            label: "G√©olocalisation",
            input_html: {
              data: {address_autocomplete_target: "address"},
              class: "form-control d-none",
              name: "artist[address]",
              value: @user.userable.address
            },
            wrapper_html: {
              class: "mapboxgl-autocomplete_signup",
              data: {
                controller: "address-autocomplete",
                address_autocomplete_api_key_value: ENV["MAP_BOX_API_KEY"]
              }
            } %>
        </div>
      </div>

      <%= f.button :submit, "Enregistrer", class: "btn btn-primary mt-3" %>
    <% end %>
</div>
